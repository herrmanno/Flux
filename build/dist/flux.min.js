!function(){var e={};!function(){window.Promise=function e(t,n){var r=this;this.data=void 0,this.resolved=!1,this.rejected=!1,this.done=!1,"function"==typeof t&&(this.onResolve=t),"function"==typeof n&&(this.onReject=n),"string"==typeof t&&(this.name=t),this.ret=void 0,this.set=function(e){if(r.done)throw"Promise is already resolved / rejected";r.data=e},this.resolve=function(e){r.set(e),r.resolved=r.done=!0,r.onResolve&&r._resolve()},this._resolve=function(){r.ret||(r.ret=new e("Return-Promise"+r.name));var t=r.onResolve(r.data);t&&t instanceof e?t.then(r.ret.resolve,r.ret.reject):r.ret.resolve(t)},this.reject=function(e){r.set(e),r.rejected=r.done=!0,r.onReject&&r.onReject(this.data),r.ret&&r.ret.reject(this.data)},this._reject=function(){r.ret||(r.ret=new e("Return-Promise"+r.name)),r.onReject(r.data),r.ret.reject(r.data)},this.then=function(t,n){return r.ret=new e("Return-Promise"+r.name),t&&"function"==typeof t&&(r.onResolve=t),n&&"function"==typeof n&&(r.onReject=n),r.resolved&&r._resolve(),r.rejected&&r._reject(),r.ret},this["catch"]=function(e){r.onReject=e,r.rejected&&r._reject()}},window.Promise.all=function(e){var t=new Promise,n=[];return 0===e.length?t.resolve():e.forEach(function(r,o){r.then(function(r){if(!t.done){n[o]=r;var i=e.reduce(function(e,t){return e&&t.resolved},!0);i&&t.resolve(n)}})["catch"](function(e){t.reject(e)})}),t}}(),function(){e.CONFIG={urls:{actions:"actions.json",stores:"stores.json",states:"states.json"},err:{"throw":!0,alert:!0}},window.Flux_config=function(t){for(var n in t)e.CONFIG[n]=t[n]}}(),function(){function t(t){if(e.CONFIG.err.alert&&window.alert("DISPATCHER: "+t),e.CONFIG.err["throw"])throw"DISPATCHER: "+t}e.err=t}(),function(){var t=function(){};t.prototype.ajax=function(e,t,n,r){var o=new Promise,i=new XMLHttpRequest;return i.onreadystatechange=function(){if(4==i.readyState){var e=i.responseText,t=i.getResponseHeader("content-type");t.match(/.*application\/json.*/)&&(e=JSON.parse(e)),200==i.status?o.resolve(e):o.reject(e)}},i.open(t,e,!0),n?r?(i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(JSON.stringify(n))):i.send(n):i.send(),o},t.prototype.GET=function(e){return t.prototype.ajax(e,"GET")},t.prototype.GET_JSON=function(e){return t.prototype.ajax(e,"GET",void 0,!0)},t.prototype.POST_JSON=function(e,n){return t.prototype.ajax(e,"POST",n,!0)},t.prototype.DELETE_JSON=function(e,n){return t.prototype.ajax(e,"DELETE",n,!0)},e.AJAX=window.AJAX=new t}(),function(){var t={loadScript:function(e){var t=new Promise,n=document.querySelectorAll('script[src="'+e+'"]');if(n.length>0)t.resolve();else{var r=document.createElement("script");r.setAttribute("src",e),r.async=!1,r.addEventListener("load",function(e){t.resolve(e)},!1),document.head.appendChild(r)}return t},loadStylesheet:function(e){var t=new Promise,n=document.querySelectorAll('link[href="'+e+'"]');if(n.length>0)t.resolve();else{var r=document.createElement("link");r.setAttribute("rel","stylesheet"),r.setAttribute("href",e),r.addEventListener("load",function(e){t.resolve(e)},!1),document.head.appendChild(r)}return t}};e.UTIL=t}(),function(){var t=function(){var t=this;t.loaded=new Promise,AJAX.GET_JSON(e.CONFIG.urls.actions).then(function(e){e.forEach(function(e){t[e]=t.createAction(e)}),t.loaded.resolve()})};t.prototype.createAction=function(e){var t=function(t){DISPATCHER.dispatch(e,t)};return t},e.ACTIONS=window.ACTIONS=new t}(),function(){"use strict";function t(){function t(e){s[e]=!0,a[e](d),c[e]=!0}function n(e){for(var t in a)s[t]=!1,c[t]=!1;d=e,u=!0}function r(){d=null,u=!1}var o="ID_",i=1,a={},s={},c={},u=!1,d=null;this.register=function(e){var t=o+i++;return a[t]=e,t},this.unregister=function(t){a[t]||e.err("Could not unregister callback for id "+t),delete a[t]},this.waitFor=function(n){u||e.err("Dispatcher.waitFor(...): Must be invoked while dispatching.");for(var r=0;r<n.length;r++){var o=n[r];s[o]?c[o]||e.err("waitFor(...): Circular dependency detected while wating for "+o):(a[o]||e.err("waitFor(...): "+o+" does not map to a registered callback."),t(o))}},this.dispatch=function(o){u&&e.err("Cannot dispatch in the middle of a dispatch."),n(o);try{for(var i in a)s[i]||t(i)}finally{r()}}}window.DISPATCHER=e.DISPATCHER=new t}(),function(){"use strict";var t=function(n){n=t.normalize(n);var r=this,o=(n.name,n.data),i="ID_",a=1,s={};this.id=void 0,this._handle=function(e){r.handle.hasOwnProperty(e.type)&&r.handle[e.type].call(r,e.data)},this.register=function(e){var t=i+a++;return s[t]=e,t},this.unregister=function(t){s[t]||e.err("Could not unregister callback for id "+t),delete s[t]},this.changed=function(){for(var e in s){var t=s[e];t&&t.call(null,o)}},function(){for(var t in n)n.hasOwnProperty(t)&&(r[t]="function"==typeof n[t]?n[t].bind(r):n[t]);e.STORES[r.name]=r,r.id=DISPATCHER.register(r._handle)}()};t.normalize=function(t){return t.name||e.err("Store.name is an required property"),void 0===t.handle&&e.err("Store.handle is an required property"),void 0===t.data&&(t.data={}),t},t.loadStore=function(t){return e.UTIL.loadScript("store/"+t)},window.Store=e.Store=t}(),function(){var t={loaded:new Promise};AJAX.GET_JSON(e.CONFIG.urls.stores).then(function(e){Promise.all(e.map(Store.loadStore)).then(t.loaded.resolve)}),window.STORES=e.STORES=t}(),function(){var t=new Store({name:"STATE",mapping:null,states:{},state:void 0,args:null,init:function(){var t=new Promise("bootstrap-state");return Promise.all([e.ACTIONS.loaded,e.STORES.loaded]).then(function(){e.ACTIONS.STATE=function(t,n){e.DISPATCHER.dispatch({type:"STATE",data:{state:t,args:n,extern:!1}})}}).then(this.getMapping).then(t.resolve),t},getMapping:function(){var n=new Promise("state-getmapping");return AJAX.GET_JSON(e.CONFIG.urls.states).then(function(e){this.mapping=e,this.initMapping(),this.initListener()}.bind(t)).then(n.resolve),n},initMapping:function(){this.mapping.forEach(function(t){t.name||e.err("Every State needs a name attibute"),t.url||e.err("Every State needs an url attibute"),t.actions=t.actions||[],t.promises=t.promises||[],t.views=t.views||[],this.states[t.name]=function(e,n){if(!this.state||this.state.name!==t.name||this.args!==e){if(t.redirect)return void this.states[t.redirect](e,n);n=!!n,this.state=t,this.args=e,this.data={state:t,args:e,extern:n};var r=this.urlFromState(t.url,e);this.setUrl(r),this.changed()}}.bind(this)}.bind(this))},initListener:function(){window.onhashchange=this.onHashChange()},onHashChange:function(){var t=this.stateFromUrl(window.location.hash.substr(1));e.DISPATCHER.dispatch({type:"STATE",data:{state:t.state,args:t.args,extern:!0}})},handle:{STATE:function(e){this.states[e.state](e.args,e.extern)}},setUrl:function(e){if(window.location.hash.substr(1)!==e){var t=window.onhashchange;window.onhashchange=null,window.location.hash=e,window.onhashchange=t}},regexFromUrl:function(e){for(var t=/:([\w]+)/;e.match(t);)e=e.replace(t,"([^/]+)");return e+"$"},argsFromUrl:function(e,t){var n=this.regexFromUrl(e),r=e.match(n).slice(1),o=t.match(n).slice(1),i={};return r.forEach(function(e,t){i[e.substr(1)]=o[t]}),i},stateFromUrl:function(t){var n=void 0;return this.mapping.forEach(function(e){if(!n){var r=this.regexFromUrl(e.url);if(t.match(r)){var o=this.argsFromUrl(e.url,t);n={state:e.name,args:o}}}}.bind(this)),n||e.err("No State found for url "+t),n},urlFromState:function(e,t){for(var n=/:([\w]+)/;e.match(n);)e=e.replace(n,function(e){return t[e.substr(1)]});return e}});window.STATE=e.STATE=t}(),function(){window.FLUX={run:function(t){return t&&Flux_config(t),e.STATE.init()}}}()}();