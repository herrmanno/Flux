/// <reference path="../../dist/d.ts/store.d.ts"/>
/// <reference path="../../dist/d.ts/flux.d.ts"/>
/// <reference path="../../dist/d.ts/router.d.ts"/>
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var View = (function (_super) {
    __extends(View, _super);
    function View() {
        _super.apply(this, arguments);
        this.html = "";
        this.properties = [
            { name: 'viewname', required: true }
        ];
    }
    View.prototype.init = function () {
        ho.flux.STORES.get(ho.flux.Router).register(this.state_changed, this);
    };
    Object.defineProperty(View.prototype, "viewname", {
        get: function () {
            return this.properties['viewname'];
        },
        enumerable: true,
        configurable: true
    });
    View.prototype.state_changed = function (data) {
        var _this = this;
        var html = data.state.view.filter(function (v) {
            return v.name === _this.viewname;
        })[0].html;
        this.getHtml(html)
            .then(function (h) {
            html = h;
            return this.loadDynamicRequirements(html);
        }.bind(this))
            .then(function () {
            this.html = false;
            this.element.innerHTML = html;
            this.render();
        }.bind(this));
    };
    View.prototype.getHtml = function (html) {
        if (typeof html === 'undefined')
            return ho.promise.Promise.create(null);
        else if (html.slice(-5) !== '.html')
            return ho.promise.Promise.create(html);
        else
            return new ho.promise.Promise(function (resolve, reject) {
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function () {
                    if (xmlhttp.readyState == 4) {
                        var resp = xmlhttp.responseText;
                        if (xmlhttp.status == 200) {
                            resolve(resp);
                        }
                        else {
                            reject(resp);
                        }
                    }
                };
                xmlhttp.open('GET', html, true);
                xmlhttp.send();
            });
    };
    View.prototype.loadDynamicRequirements = function (html) {
        var requirements = html.match(/<!--\s*requires?="(.+)"/);
        if (requirements !== null)
            requirements = requirements[1].split(",").map(function (r) { return r.trim(); });
        else
            requirements = [];
        var Registry = ho.components.registry.instance;
        var promises = requirements
            .filter(function (req) {
            return !Registry.hasComponent(req);
        })
            .map(function (req) {
            return Registry.loadComponent(req);
        });
        return ho.promise.Promise.all(promises);
    };
    return View;
})(ho.components.Component);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlldy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInZpZXcudHMiXSwibmFtZXMiOlsiVmlldyIsIlZpZXcuY29uc3RydWN0b3IiLCJWaWV3LmluaXQiLCJWaWV3LnZpZXduYW1lIiwiVmlldy5zdGF0ZV9jaGFuZ2VkIiwiVmlldy5nZXRIdG1sIiwiVmlldy5sb2FkRHluYW1pY1JlcXVpcmVtZW50cyJdLCJtYXBwaW5ncyI6IkFBQUEsa0RBQWtEO0FBQ2xELGlEQUFpRDtBQUNqRCxtREFBbUQ7Ozs7OztBQUVuRDtJQUFtQkEsd0JBQXVCQTtJQUExQ0E7UUFBbUJDLDhCQUF1QkE7UUFFekNBLFNBQUlBLEdBQUdBLEVBQUVBLENBQUNBO1FBRVZBLGVBQVVBLEdBQUdBO1lBQ1pBLEVBQUNBLElBQUlBLEVBQUVBLFVBQVVBLEVBQUVBLFFBQVFBLEVBQUVBLElBQUlBLEVBQUNBO1NBQ2xDQSxDQUFDQTtJQXlFSEEsQ0FBQ0E7SUF2RUFELG1CQUFJQSxHQUFKQTtRQUNDRSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtJQUV2RUEsQ0FBQ0E7SUFFREYsc0JBQUlBLDBCQUFRQTthQUFaQTtZQUNDRyxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtRQUNwQ0EsQ0FBQ0E7OztPQUFBSDtJQUVEQSw0QkFBYUEsR0FBYkEsVUFBY0EsSUFBeUJBO1FBQXZDSSxpQkFlQ0E7UUFkQUEsSUFBSUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsVUFBQ0EsQ0FBQ0E7WUFDbkNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLElBQUlBLEtBQUtBLEtBQUlB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LEdBQUdBLEVBQUVBLENBQUNBO1FBRW5CQSxJQUFJQSxRQUFRQSxHQUFHQSxFQUFFQSxDQUFDQSxVQUFVQSxDQUFDQSxRQUFRQSxDQUFDQSxRQUFRQSxDQUFDQTtRQUUvQ0EsSUFBSUEsUUFBUUEsR0FBR0EsWUFBWUE7YUFDcEJBLE1BQU1BLENBQUNBLFVBQUNBLEdBQUdBO1lBQ1JBLE1BQU1BLENBQUNBLENBQUNBLFFBQVFBLENBQUNBLFlBQVlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQ3ZDQSxDQUFDQSxDQUFDQTthQUNEQSxHQUFHQSxDQUFDQSxVQUFDQSxHQUFHQTtZQUNMQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxhQUFhQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUN2Q0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFVEEsTUFBTUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7SUFDekNBLENBQUNBO0lBR0ZOLFdBQUNBO0FBQURBLENBQUNBLEFBL0VELEVBQW1CLEVBQUUsQ0FBQyxVQUFVLENBQUMsU0FBUyxFQStFekMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vZGlzdC9kLnRzL3N0b3JlLmQudHNcIi8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vZGlzdC9kLnRzL2ZsdXguZC50c1wiLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi9kaXN0L2QudHMvcm91dGVyLmQudHNcIi8+XG5cbmNsYXNzIFZpZXcgZXh0ZW5kcyBoby5jb21wb25lbnRzLkNvbXBvbmVudCB7XG5cblx0aHRtbCA9IFwiXCI7XG5cblx0cHJvcGVydGllcyA9IFtcblx0XHR7bmFtZTogJ3ZpZXduYW1lJywgcmVxdWlyZWQ6IHRydWV9XG5cdF07XG5cblx0aW5pdCgpIHtcblx0XHRoby5mbHV4LlNUT1JFUy5nZXQoaG8uZmx1eC5Sb3V0ZXIpLnJlZ2lzdGVyKHRoaXMuc3RhdGVfY2hhbmdlZCwgdGhpcyk7XG5cdFx0Ly9oby5mbHV4LlNUT1JFU1snUm91dGVyJ10ucmVnaXN0ZXIodGhpcy5zdGF0ZV9jaGFuZ2VkLmJpbmQodGhpcykpO1xuXHR9XG5cblx0Z2V0IHZpZXduYW1lKCkge1xuXHRcdHJldHVybiB0aGlzLnByb3BlcnRpZXNbJ3ZpZXduYW1lJ107XG5cdH1cblxuXHRzdGF0ZV9jaGFuZ2VkKGRhdGE6IGhvLmZsdXguSVJvdXRlckRhdGEpOiB2b2lkIHtcblx0XHRsZXQgaHRtbCA9IGRhdGEuc3RhdGUudmlldy5maWx0ZXIoKHYpID0+IHtcblx0XHRcdHJldHVybiB2Lm5hbWUgPT09IHRoaXMudmlld25hbWU7XG5cdFx0fSlbMF0uaHRtbDtcblxuXHRcdHRoaXMuZ2V0SHRtbChodG1sKVxuXHRcdC50aGVuKGZ1bmN0aW9uKGgpIHtcblx0XHRcdGh0bWwgPSBoO1xuXHRcdFx0cmV0dXJuIHRoaXMubG9hZER5bmFtaWNSZXF1aXJlbWVudHMoaHRtbCk7XG5cdFx0fS5iaW5kKHRoaXMpKVxuXHRcdC50aGVuKGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy5odG1sID0gZmFsc2U7XG5cdFx0XHR0aGlzLmVsZW1lbnQuaW5uZXJIVE1MID0gaHRtbDtcblx0XHRcdHRoaXMucmVuZGVyKCk7XG5cdFx0fS5iaW5kKHRoaXMpKTtcblx0fVxuXG5cdHByb3RlY3RlZCBnZXRIdG1sKGh0bWw6IHN0cmluZyk6ICBoby5wcm9taXNlLlByb21pc2U8c3RyaW5nLCBzdHJpbmc+IHtcblx0XHRpZih0eXBlb2YgaHRtbCA9PT0gJ3VuZGVmaW5lZCcpXG5cdFx0XHRyZXR1cm4gaG8ucHJvbWlzZS5Qcm9taXNlLmNyZWF0ZShudWxsKTtcblx0XHRlbHNlIGlmKGh0bWwuc2xpY2UoLTUpICE9PSAnLmh0bWwnKVxuXHRcdFx0cmV0dXJuIGhvLnByb21pc2UuUHJvbWlzZS5jcmVhdGUoaHRtbCk7XG5cdFx0ZWxzZSByZXR1cm4gbmV3IGhvLnByb21pc2UuUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cblx0XHRcdGxldCB4bWxodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cdFx0XHR4bWxodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRpZih4bWxodHRwLnJlYWR5U3RhdGUgPT0gNCkge1xuXHRcdFx0XHRcdHZhciByZXNwID0geG1saHR0cC5yZXNwb25zZVRleHQ7XG5cdFx0XHRcdFx0aWYoeG1saHR0cC5zdGF0dXMgPT0gMjAwKSB7XG5cdFx0XHRcdFx0XHRyZXNvbHZlKHJlc3ApO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRyZWplY3QocmVzcCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9O1xuXG5cdFx0XHR4bWxodHRwLm9wZW4oJ0dFVCcsIGh0bWwsIHRydWUpO1xuXHRcdFx0eG1saHR0cC5zZW5kKCk7XG5cdFx0fSk7XG5cdH1cblxuXHRwcm90ZWN0ZWQgbG9hZER5bmFtaWNSZXF1aXJlbWVudHMoaHRtbDogc3RyaW5nKTogaG8ucHJvbWlzZS5Qcm9taXNlPHN0cmluZywgc3RyaW5nPiB7XG5cdFx0bGV0IHJlcXVpcmVtZW50cyA9IGh0bWwubWF0Y2goLzwhLS1cXHMqcmVxdWlyZXM/PVwiKC4rKVwiLyk7XG5cdFx0aWYocmVxdWlyZW1lbnRzICE9PSBudWxsKVxuXHRcdFx0cmVxdWlyZW1lbnRzID0gcmVxdWlyZW1lbnRzIFsxXS5zcGxpdChcIixcIikubWFwKChyKSA9PiB7cmV0dXJuIHIudHJpbSgpfSk7XG5cdFx0ZWxzZVxuXHRcdFx0cmVxdWlyZW1lbnRzID0gW107XG5cblx0XHRsZXQgUmVnaXN0cnkgPSBoby5jb21wb25lbnRzLnJlZ2lzdHJ5Lmluc3RhbmNlO1xuXG5cdFx0bGV0IHByb21pc2VzID0gcmVxdWlyZW1lbnRzXG4gICAgICAgIC5maWx0ZXIoKHJlcSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuICFSZWdpc3RyeS5oYXNDb21wb25lbnQocmVxKTtcbiAgICAgICAgfSlcbiAgICAgICAgLm1hcCgocmVxKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gUmVnaXN0cnkubG9hZENvbXBvbmVudChyZXEpO1xuICAgICAgICB9KTtcblxuXHRcdHJldHVybiBoby5wcm9taXNlLlByb21pc2UuYWxsKHByb21pc2VzKTtcblx0fVxuXG5cbn1cbiJdfQ==