!function(){var t={};!function(){window.Promise=function t(e,n){var r=this;this.data=void 0,this.resolved=!1,this.rejected=!1,this.done=!1,"function"==typeof e&&(this.onResolve=e),"function"==typeof n&&(this.onReject=n),"string"==typeof e&&(this.name=e),this.ret=void 0,this.set=function(t){if(r.done)throw"Promise is already resolved / rejected";r.data=t},this.resolve=function(t){r.set(t),r.resolved=r.done=!0,r.onResolve&&r._resolve()},this._resolve=function(){r.ret||(r.ret=new t("Return-Promise"+r.name));var e=r.onResolve(r.data);e&&e instanceof t?e.then(r.ret.resolve,r.ret.reject):r.ret.resolve(e)},this.reject=function(t){r.set(t),r.rejected=r.done=!0,r.onReject&&r.onReject(this.data),r.ret&&r.ret.reject(this.data)},this._reject=function(){r.ret||(r.ret=new t("Return-Promise"+r.name)),r.onReject(r.data),r.ret.reject(r.data)},this.then=function(e,n){return r.ret=new t("Return-Promise"+r.name),e&&"function"==typeof e&&(r.onResolve=e),n&&"function"==typeof n&&(r.onReject=n),r.resolved&&r._resolve(),r.rejected&&r._reject(),r.ret},this["catch"]=function(t){r.onReject=t,r.rejected&&r._reject()}},window.Promise.all=function(t){var e=new Promise,n=[];return 0===t.length?e.resolve():t.forEach(function(r,o){r.then(function(r){if(!e.done){n[o]=r;var i=t.reduce(function(t,e){return t&&e.resolved},!0);i&&e.resolve(n)}})["catch"](function(t){e.reject(t)})}),e},window.Promise.create=function(t){if(t instanceof Promise)return t;var e=new Promise;return void 0===t||null===t||t===!1?e.reject(t):e.resolve(t),e}}(),function(){t.CONFIG={urls:{actions:"actions.json",stores:"stores.json",states:"states.json"},err:{"throw":!0,alert:!0}},window.Flux_config=function(e){for(var n in e)t.CONFIG[n]=e[n]}}(),function(){function e(e){if(t.CONFIG.err.alert&&window.alert("DISPATCHER: "+e),t.CONFIG.err["throw"])throw"DISPATCHER: "+e}t.err=e}(),function(){var e=function(){};e.prototype.ajax=function(t,e,n,r){var o=new Promise,i=new XMLHttpRequest;return i.onreadystatechange=function(){if(4==i.readyState){var t=i.responseText,e=i.getResponseHeader("content-type");e.match(/.*application\/json.*/)&&(t=JSON.parse(t)),200==i.status?o.resolve(t):o.reject(t)}},i.open(e,t,!0),n?r?(i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(JSON.stringify(n))):i.send(n):i.send(),o},e.prototype.GET=function(t){return e.prototype.ajax(t,"GET")},e.prototype.GET_JSON=function(t){return e.prototype.ajax(t,"GET",void 0,!0)},e.prototype.POST_JSON=function(t,n){return e.prototype.ajax(t,"POST",n,!0)},e.prototype.DELETE_JSON=function(t,n){return e.prototype.ajax(t,"DELETE",n,!0)},t.AJAX=window.AJAX=new e}(),function(){var e={loadScript:function(t){var e=new Promise,n=document.querySelectorAll('script[src="'+t+'"]');if(n.length>0)e.resolve();else{var r=document.createElement("script");r.setAttribute("src",t),r.async=!1,r.addEventListener("load",function(t){e.resolve(t)},!1),document.head.appendChild(r)}return e},loadStylesheet:function(t){var e=new Promise,n=document.querySelectorAll('link[href="'+t+'"]');if(n.length>0)e.resolve();else{var r=document.createElement("link");r.setAttribute("rel","stylesheet"),r.setAttribute("href",t),r.addEventListener("load",function(t){e.resolve(t)},!1),document.head.appendChild(r)}return e}};t.UTIL=e}(),function(){var e=function(){var e=this;this.load=function(){var n=new Promise("actions-load");return AJAX.GET_JSON(t.CONFIG.urls.actions).then(function(t){t.forEach(function(t){e[t]=e.createAction(t)}),n.resolve()}),n}};e.prototype.createAction=function(t){var e=function(e){DISPATCHER.dispatch(t,e)};return e},t.ACTIONS=window.ACTIONS=new e}(),function(){"use strict";function e(){function e(t){s[t]=!0,a[t](l),c[t]=!0}function n(t){for(var e in a)s[e]=!1,c[e]=!1;l=t,u=!0}function r(){l=null,u=!1}var o="ID_",i=1,a={},s={},c={},u=!1,l=null;this.register=function(t){var e=o+i++;return a[e]=t,e},this.unregister=function(e){a[e]||t.err("Could not unregister callback for id "+e),delete a[e]},this.waitFor=function(n){u||t.err("Dispatcher.waitFor(...): Must be invoked while dispatching.");for(var r=0;r<n.length;r++){var o=n[r];s[o]?c[o]||t.err("waitFor(...): Circular dependency detected while wating for "+o):(a[o]||t.err("waitFor(...): "+o+" does not map to a registered callback."),e(o))}},this.dispatch=function(o){u&&t.err("Cannot dispatch in the middle of a dispatch."),n(o);try{for(var i in a)s[i]||e(i)}finally{r()}}}window.DISPATCHER=t.DISPATCHER=new e}(),function(){"use strict";var e=function(n){n=e.normalize(n);var r=this,o=(n.name,n.data),i="ID_",a=1,s={};this.id=void 0,this._handle=function(t){r.handle.hasOwnProperty(t.type)&&r.handle[t.type].call(r,t.data)},this.register=function(t){var e=i+a++;return s[e]=t,e},this.unregister=function(e){s[e]||t.err("Could not unregister callback for id "+e),delete s[e]},this.changed=function(){for(var t in s){var e=s[t];e&&e.call(null,o)}},function(){for(var e in n)n.hasOwnProperty(e)&&(r[e]="function"==typeof n[e]?n[e].bind(r):n[e]);t.STORES[r.name]=r,r.id=DISPATCHER.register(r._handle)}()};e.normalize=function(e){return e.name||t.err("Store.name is an required property"),void 0===e.handle&&t.err("Store.handle is an required property"),void 0===e.data&&(e.data={}),e},e.loadStore=function(e){return t.UTIL.loadScript("store/"+e)},window.Store=t.Store=e}(),function(){var e={load:function(){var e=new Promise("stores-load");return AJAX.GET_JSON(t.CONFIG.urls.stores).then(function(t){Promise.all(t.map(Store.loadStore)).then(e.resolve)}),e}};window.STORES=t.STORES=e}(),function(){var e=new Store({name:"STATE",mapping:null,states:{},state:void 0,args:null,init:function(){var e=new Promise("bootstrap-state");return Promise.all([t.ACTIONS.load(),t.STORES.load()]).then(function(){t.ACTIONS.STATE=function(e,n){t.DISPATCHER.dispatch({type:"STATE",data:{state:e,args:n,extern:!1}})}}).then(this.getMapping).then(e.resolve),e},getMapping:function(){var n=new Promise("state-getmapping");return AJAX.GET_JSON(t.CONFIG.urls.states).then(function(t){this.mapping=t,this.initMapping(),this.initListener()}.bind(e)).then(n.resolve),n},initMapping:function(){this.mapping.forEach(function(e){e.name||t.err("Every State needs a name attibute"),e.url||t.err("Every State needs an url attibute"),e.actions=e.actions||[],e.promises=e.promises||[],e.views=e.views||[],this.states[e.name]=function(t,n){if(!this.state||this.state.name!==e.name||this.args!==t){if(e.redirect)return void this.states[e.redirect](t,n);n=!!n,this.state=e,this.args=t,this.data={state:e,args:t,extern:n};var r=this.urlFromState(e.url,t);this.setUrl(r),this.changed()}}.bind(this)}.bind(this))},initListener:function(){window.onhashchange=this.onHashChange()},onHashChange:function(){var e=this.stateFromUrl(window.location.hash.substr(1));t.DISPATCHER.dispatch({type:"STATE",data:{state:e.state,args:e.args,extern:!0}})},handle:{STATE:function(t){this.states[t.state](t.args,t.extern)}},setUrl:function(t){if(window.location.hash.substr(1)!==t){var e=window.onhashchange;window.onhashchange=null,window.location.hash=t,window.onhashchange=e}},regexFromUrl:function(t){for(var e=/:([\w]+)/;t.match(e);)t=t.replace(e,"([^/]+)");return t+"$"},argsFromUrl:function(t,e){var n=this.regexFromUrl(t),r=t.match(n).slice(1),o=e.match(n).slice(1),i={};return r.forEach(function(t,e){i[t.substr(1)]=o[e]}),i},stateFromUrl:function(e){var n=void 0;return this.mapping.forEach(function(t){if(!n){var r=this.regexFromUrl(t.url);if(e.match(r)){var o=this.argsFromUrl(t.url,e);n={state:t.name,args:o}}}}.bind(this)),n||t.err("No State found for url "+e),n},urlFromState:function(t,e){for(var n=/:([\w]+)/;t.match(n);)t=t.replace(n,function(t){return e[t.substr(1)]});return t}});window.STATE=t.STATE=e}(),function(){window.FLUX={run:function(e){return e&&Flux_config(e),t.STATE.init()}}}()}();