var ho;!function(t){var n;!function(t){var n=function(){function t(){this.prefix="ID_",this.lastID=1,this.callbacks={}}return t.prototype.register=function(t,n){var i=this.prefix+this.lastID++;return this.callbacks[i]=n?t.bind(n):t,i},t.prototype.unregister=function(t){if(!this.callbacks[t])throw"Could not unregister callback for id "+t;delete this.callbacks[t]},t}();t.CallbackHolder=n}(n=t.flux||(t.flux={}))}(ho||(ho={}));var ho;!function(t){var n;!function(t){var n;!function(t){var n=function(){function t(){}return Object.defineProperty(t.prototype,"name",{get:function(){return this.constructor.toString().match(/\w+/g)[1]},enumerable:!0,configurable:!0}),t}();t.Action=n}(n=t.actions||(t.actions={}))}(n=t.flux||(t.flux={}))}(ho||(ho={}));var ho;!function(t){var n;!function(n){var i;!function(n){var i=t.promise.Promise;n.mapping={},n.useDir=!0;var r=function(){function r(){this.actions={},this.actionLoader=new t.classloader.ClassLoader({urlTemplate:"actions/${name}.js",useDir:n.useDir})}return r.prototype.register=function(t){return this.actions[t.name]=t,t},r.prototype.get=function(t){var n=void 0;return n="string"==typeof t?t:t.toString().match(/\w+/g)[1],this.actions[n]},r.prototype.loadAction=function(t){var r=this;return this.actions[t]?i.create(this.actions[t]):this.actionLoader.load({name:t,url:n.mapping[t],"super":["ho.flux.actions.Action"]}).then(function(t){return t.map(function(t){r.get(t)||r.register(new t)}),r.get(t.pop())})},r}();n.Registry=r}(i=n.actions||(n.actions={}))}(n=t.flux||(t.flux={}))}(ho||(ho={}));var ho;!function(t){var n;!function(n){var i;!function(n){var i=t.promise.Promise;n.mapping={},n.useDir=!0;var r=function(){function r(){this.stores={},this.storeLoader=new t.classloader.ClassLoader({urlTemplate:"stores/${name}.js",useDir:n.useDir})}return r.prototype.register=function(t){return this.stores[t.name]=t,t},r.prototype.get=function(t){var n=void 0;return n="string"==typeof t?t:t.toString().match(/\w+/g)[1],this.stores[n]},r.prototype.loadStore=function(t,r){void 0===r&&(r=!0);var o=this,e=[];return this.stores[t]?i.create(this.stores[t]):this.storeLoader.load({name:t,url:n.mapping[t],"super":["ho.flux.Store"]}).then(function(t){e=t,t=t.filter(function(t){return!o.get(t)});var n=t.map(function(t){var n=o.register(new t);return r&&(n=n.init()),i.create(n)});return i.all(n)}).then(function(t){return o.get(e.pop())})},r}();n.Registry=r}(i=n.registry||(n.registry={}))}(n=t.flux||(t.flux={}))}(ho||(ho={}));var __extends=this&&this.__extends||function(t,n){function i(){this.constructor=t}for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r]);i.prototype=n.prototype,t.prototype=new i},ho;!function(t){var n;!function(n){var i=function(n){function i(){n.call(this),this.handlers={},this.actions=[],this.id=t.flux.DISPATCHER.register(this.handle.bind(this));var r=this,o=i.handlerMap[this.constructor.prototype];for(var e in o){var a=o[e];a.forEach(function(t){var n=r[t].bind(r);r.on(e,n)})}}return __extends(i,n),i.prototype.init=function(){return t.promise.Promise.all(this.actions.map(function(n){return t.flux.ACTIONS.loadAction(n)}))},Object.defineProperty(i.prototype,"name",{get:function(){return this.constructor.toString().match(/\w+/g)[1]},enumerable:!0,configurable:!0}),i.prototype.register=function(t,i){return n.prototype.register.call(this,t,i)},i.prototype.on=function(t,n){this.handlers[t]=n},i.prototype.handle=function(t){"function"==typeof this.handlers[t.type]&&this.handlers[t.type](t.data)},i.prototype.changed=function(){for(var t in this.callbacks){var n=this.callbacks[t];n&&n(this.data)}},i.handlerMap={},i.on=function(t){return function(n,r,o){return i.handlerMap[n]=i.handlerMap[n]||{},i.handlerMap[n][t]=i.handlerMap[n][t]||[],i.handlerMap[n][t].push(r),o}},i}(n.CallbackHolder);n.Store=i}(n=t.flux||(t.flux={}))}(ho||(ho={}));var __extends=this&&this.__extends||function(t,n){function i(){this.constructor=t}for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r]);i.prototype=n.prototype,t.prototype=new i},ho;!function(t){var n;!function(t){var n=function(t){function n(){t.apply(this,arguments),this.isPending={},this.isHandled={},this.isDispatching=!1,this.pendingPayload=null}return __extends(n,t),n.prototype.waitFor=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];if(!this.isDispatching)throw"Dispatcher.waitFor(...): Must be invoked while dispatching.";for(var i=0;i<t.length;i++){var r=t[i];if(this.isPending[r]){if(!this.isHandled[r])throw"waitFor(...): Circular dependency detected while wating for "+r}else{if(!this.callbacks[r])throw"waitFor(...): "+r+" does not map to a registered callback.";this.invokeCallback(r)}}},n.prototype.dispatch=function(t){if(this.isDispatching)throw"Cannot dispatch in the middle of a dispatch.";this.startDispatching(t);try{for(var n in this.callbacks)this.isPending[n]||this.invokeCallback(n)}finally{this.stopDispatching()}},n.prototype.invokeCallback=function(t){this.isPending[t]=!0,this.callbacks[t](this.pendingPayload),this.isHandled[t]=!0},n.prototype.startDispatching=function(t){for(var n in this.callbacks)this.isPending[n]=!1,this.isHandled[n]=!1;this.pendingPayload=t,this.isDispatching=!0},n.prototype.stopDispatching=function(){this.pendingPayload=null,this.isDispatching=!1},n}(t.CallbackHolder);t.Dispatcher=n}(n=t.flux||(t.flux={}))}(ho||(ho={}));var ho;!function(t){var n;!function(t){t.DISPATCHER=new t.Dispatcher,t.STORES=new t.registry.Registry,t.ACTIONS=new t.actions.Registry,t.dir=!1}(n=t.flux||(t.flux={}))}(ho||(ho={}));