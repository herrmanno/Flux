var ho;!function(t){var n;!function(t){var n=function(){function t(){this.prefix="ID_",this.lastID=1,this.callbacks={}}return t.prototype.register=function(t,n){var e=this.prefix+this.lastID++;return this.callbacks[e]=n?t.bind(n):t,e},t.prototype.unregister=function(t){if(!this.callbacks[t])throw"Could not unregister callback for id "+t;delete this.callbacks[t]},t}();t.CallbackHolder=n}(n=t.flux||(t.flux={}))}(ho||(ho={}));var ho;!function(t){var n;!function(n){var e;!function(n){var e=t.promise.Promise,r=function(){function t(){this.useMin=!1}return t.prototype.resolve=function(){return this.useMin?"states.min.js":"states.js"},t.prototype.getStates=function(t){var n=this;return void 0===t&&(t="States"),new e(function(e,r){var o=n.resolve(),i=document.createElement("script");i.onload=function(){e(new window[t])},i.onerror=function(t){r(t)},i.src=o,document.getElementsByTagName("head")[0].appendChild(i)})},t}();n.instance=new r}(e=n.stateprovider||(n.stateprovider={}))}(n=t.flux||(t.flux={}))}(ho||(ho={}));var ho;!function(t){var n;!function(n){var e;!function(e){var r=t.promise.Promise;e.mapping={};var o=function(){function t(){this.useMin=!1}return t.prototype.resolve=function(t){return t=t.split(".").join("/"),this.useMin?"stores/"+t+".min.js":"stores/"+t+".js"},t.prototype.getStore=function(t){var o=this;return void 0!==window[t]&&window[t].prototype instanceof n.Store?r.create(window[t]):new r(function(n,r){var i=e.mapping[t]||o.resolve(t),s=document.createElement("script");s.onload=function(){"function"==typeof this.get(t)?n(this.get(t)):r("Error while loading Store "+t)}.bind(o),s.src=i,document.getElementsByTagName("head")[0].appendChild(s)})},t.prototype.get=function(t){var n=window;return t.split(".").forEach(function(t){n=n[t]}),n},t}();e.instance=new o}(e=n.storeprovider||(n.storeprovider={}))}(n=t.flux||(t.flux={}))}(ho||(ho={}));var ho;!function(t){var n;!function(n){var e=t.promise.Promise,r=function(){function r(){this.stores={}}return r.prototype.register=function(t){return this.stores[t.name]=t,t},r.prototype.get=function(t){var n=t.toString().match(/\w+/g)[1];return this.stores[n]},r.prototype.loadStore=function(e){var r=this,o=this.getParentOfStore(e).then(function(t){return r.stores[t]instanceof n.Store||"ho.flux.Store"===t?!0:r.loadStore(t)}).then(function(n){return t.flux.storeprovider.instance.getStore(e)}).then(function(t){return r.register(new t).init()}).then(function(){return r.stores[e]});return o},r.prototype.getParentOfStore=function(n){return new e(function(e,r){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState){var t=o.responseText;if(200==o.status){var n=t.match(/}\)\((.*)\);/);e(null!==n?n[1]:null)}else r(t)}},o.open("GET",t.flux.storeprovider.instance.resolve(n)),o.send()})},r}();n.Storeregistry=r}(n=t.flux||(t.flux={}))}(ho||(ho={}));var __extends=this&&this.__extends||function(t,n){function e(){this.constructor=t}for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r]);e.prototype=n.prototype,t.prototype=new e},ho;!function(t){var n;!function(n){var e=function(n){function e(){n.call(this),this.handlers={},this.id=t.flux.DISPATCHER.register(this.handle.bind(this)),t.flux.STORES.register(this)}return __extends(e,n),e.prototype.init=function(){},Object.defineProperty(e.prototype,"name",{get:function(){return this.constructor.toString().match(/\w+/g)[1]},enumerable:!0,configurable:!0}),e.prototype.register=function(t,e){return n.prototype.register.call(this,t,e)},e.prototype.on=function(t,n){this.handlers[t]=n},e.prototype.handle=function(t){"function"==typeof this.handlers[t.type]&&this.handlers[t.type](t.data)},e.prototype.changed=function(){for(var t in this.callbacks){var n=this.callbacks[t];n&&n(this.data)}},e}(n.CallbackHolder);n.Store=e}(n=t.flux||(t.flux={}))}(ho||(ho={}));var __extends=this&&this.__extends||function(t,n){function e(){this.constructor=t}for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r]);e.prototype=n.prototype,t.prototype=new e},ho;!function(t){var n;!function(n){var e=t.promise.Promise,r=function(r){function o(){r.call(this),this.mapping=null}return __extends(o,r),o.prototype.init=function(){this.on("STATE",this.onStateChangeRequested.bind(this));var t=this.onHashChange.bind(this);return this.initStates().then(function(){window.onhashchange=t,t()})},o.prototype.go=function(n){t.flux.DISPATCHER.dispatch({type:"STATE",data:n})},o.prototype.initStates=function(){return n.stateprovider.instance.getStates().then(function(t){this.mapping=t.states}.bind(this))},o.prototype.getStateFromName=function(t){return this.mapping.filter(function(n){return n.name===t})[0]},o.prototype.onStateChangeRequested=function(t){if(!(this.data&&this.data.state&&this.data.state.name===t.state&&this.equals(this.data.args,t.args))){var n=this.getStateFromName(t.state);n.redirect&&(n=this.getStateFromName(n.redirect));var r="function"==typeof n.before?n.before(t):e.create(void 0);r.then(function(){var e=!!t.extern;this.data={state:n,args:t.args,extern:e};var r=this.urlFromState(n.url,t.args);this.setUrl(r),this.changed()}.bind(this),function(t){this.onStateChangeRequested(t)}.bind(this))}},o.prototype.onHashChange=function(){var n=this.stateFromUrl(window.location.hash.substr(1));t.flux.DISPATCHER.dispatch({type:"STATE",data:{state:n.state,args:n.args,extern:!0}})},o.prototype.setUrl=function(t){if(window.location.hash.substr(1)!==t){var n=window.onhashchange;window.onhashchange=null,window.location.hash=t,window.onhashchange=n}},o.prototype.regexFromUrl=function(t){for(var n=/:([\w]+)/;t.match(n);)t=t.replace(n,"([^/]+)");return t+"$"},o.prototype.argsFromUrl=function(t,n){var e=this.regexFromUrl(t),r=t.match(e).slice(1),o=n.match(e).slice(1),i={};return r.forEach(function(t,n){i[t.substr(1)]=o[n]}),i},o.prototype.stateFromUrl=function(t){var n=this,e=void 0;if(this.mapping.forEach(function(r){if(!e){var o=n.regexFromUrl(r.url);if(t.match(o)){var i=n.argsFromUrl(r.url,t);e={state:r.name,args:i,extern:!1}}}}),!e)throw"No State found for url "+t;return e},o.prototype.urlFromState=function(t,n){for(var e=/:([\w]+)/;t.match(e);)t=t.replace(e,function(t){return n[t.substr(1)]});return t},o.prototype.equals=function(t,n){return JSON.stringify(t)===JSON.stringify(n)},o}(n.Store);n.Router=r}(n=t.flux||(t.flux={}))}(ho||(ho={}));var __extends=this&&this.__extends||function(t,n){function e(){this.constructor=t}for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r]);e.prototype=n.prototype,t.prototype=new e},ho;!function(t){var n;!function(t){var n=function(t){function n(){t.apply(this,arguments),this.isPending={},this.isHandled={},this.isDispatching=!1,this.pendingPayload=null}return __extends(n,t),n.prototype.waitFor=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];if(!this.isDispatching)throw"Dispatcher.waitFor(...): Must be invoked while dispatching.";for(var e=0;e<t.length;e++){var r=t[e];if(this.isPending[r]){if(!this.isHandled[r])throw"waitFor(...): Circular dependency detected while wating for "+r}else{if(!this.callbacks[r])throw"waitFor(...): "+r+" does not map to a registered callback.";this.invokeCallback(r)}}},n.prototype.dispatch=function(t){if(this.isDispatching)throw"Cannot dispatch in the middle of a dispatch.";this.startDispatching(t);try{for(var n in this.callbacks)this.isPending[n]||this.invokeCallback(n)}finally{this.stopDispatching()}},n.prototype.invokeCallback=function(t){this.isPending[t]=!0,this.callbacks[t](this.pendingPayload),this.isHandled[t]=!0},n.prototype.startDispatching=function(t){for(var n in this.callbacks)this.isPending[n]=!1,this.isHandled[n]=!1;this.pendingPayload=t,this.isDispatching=!0},n.prototype.stopDispatching=function(){this.pendingPayload=null,this.isDispatching=!1},n}(t.CallbackHolder);t.Dispatcher=n}(n=t.flux||(t.flux={}))}(ho||(ho={}));var ho;!function(t){var n;!function(n){function e(){return n.STORES.get(n.Router).init()}n.DISPATCHER=new n.Dispatcher,n.STORES=new n.Storeregistry,void 0===t.flux.STORES.get(n.Router)&&new n.Router,n.run=e}(n=t.flux||(t.flux={}))}(ho||(ho={}));